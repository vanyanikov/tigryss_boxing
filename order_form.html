<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Оформлення замовлення</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f7f7f7; padding:20px; }
    .card { max-width: 640px; margin: 0 auto; background:#fff; border-radius:10px; box-shadow:0 6px 22px rgba(0,0,0,.07); padding:18px; }
    h1 { margin-bottom: 16px; }
    label { display:block; margin:10px 0 6px; }
    input, select, textarea { width:100%; padding:10px; border:1px solid #ddd; border-radius:6px; }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    button { margin-top:14px; padding:10px 14px; background:#282828; color:#fff; border:0; border-radius:8px; cursor:pointer; }
    .ok { background: #ebfff1; border:1px solid #bdf5cd; color:#1c7c3a; padding:10px; border-radius:6px; display:none; margin-top:10px; }
    .err { background: #fff2f2; border:1px solid #ffd3d3; color:#a33; padding:10px; border-radius:6px; display:none; margin-top:10px; }
    a { color:#282828; text-decoration:none; }
  </style>
</head>
<body>
  <div class="card">
    <a href="index.html">← На головну</a>
    <h1>Оформлення замовлення</h1>
    <form id="orderForm" method="post" action="save_order.php">
      <label>Імʼя*</label>
      <input name="name" required>

      <label>Телефон*</label>
      <input name="phone" required placeholder="+380…">

      <label>Товар*</label>
      <input name="product" id="product" required>

      <div class="row">
        <div>
          <label>Варіант</label>
          <input name="variant" id="variant" placeholder="laces/velcro або колір">
        </div>
        <div>
          <label>Розмір</label>
          <select name="size" id="size">
            <option value="">—</option>
            <option>10 oz</option>
            <option>12 oz</option>
            <option>14 oz</option>
            <option>16 oz</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Кількість</label>
          <input type="number" min="1" value="1" name="quantity">
        </div>
        <div>
          <label>Ціна</label>
          <input type="number" min="0" step="0.01" value="0" name="price">
        </div>
      </div>

      <label>Коментар</label>
      <textarea name="notes" rows="3"></textarea>

      <!-- UTM (если есть) -->
      <input type="hidden" name="utm_source">
      <input type="hidden" name="utm_medium">
      <input type="hidden" name="utm_campaign">
      <input type="hidden" name="utm_term">
      <input type="hidden" name="utm_content">

      <button type="submit">Відправити</button>

      <div class="ok" id="okMsg">Замовлення відправлено! Дякуємо ❤️</div>
      <div class="err" id="errMsg">Сталася помилка. Спробуйте пізніше.</div>
    </form>
  </div>

  <script>
    // Подхватываем product/variant/size из query string (с карточек)
    const params = new URLSearchParams(location.search);
    for (const k of ['product','variant','size']) {
      if (params.get(k)) document.getElementById(k)?.setAttribute('value', params.get(k));
      if (k === 'size' && params.get(k)) document.getElementById('size').value = params.get(k);
    }

    // Подхват UTM
    const utmKeys = ['utm_source','utm_medium','utm_campaign','utm_term','utm_content'];
    utmKeys.forEach(k => {
      const el = document.querySelector(`input[name="${k}"]`);
      if (el) el.value = params.get(k) || '';
    });

    // AJAX-отправка, чтобы оставаться на странице
    const form = document.getElementById('orderForm');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const ok = document.getElementById('okMsg');
      const err = document.getElementById('errMsg');
      ok.style.display = 'none';
      err.style.display = 'none';
      try {
        const resp = await fetch(form.action, {
          method: 'POST',
          body: new FormData(form)
        });
        const json = await resp.json();
        if (json.ok) {
          ok.style.display = 'block';
          form.reset();
        } else {
          err.style.display = 'block';
        }
      } catch (_) {
        err.style.display = 'block';
      }
    });
  </script>
</body>
</html>
